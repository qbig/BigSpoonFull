{% extends "staff.html" %}
{% load staticfiles %}
{% load compress %}
{% load cache %}
{% load menufilters %}
{% block content %}
    <div class="wrapper">
       {% verbatim %}


        <script id="card-template-order" type="text/x-handlebars-template">
                {{#ifCond meal_wait_time.min '>=' 3}}
                    <span class = "urgent time countdown" start = {{meal_start_time}}>
                {{else}}
                    <span class = "early time countdown" start= {{meal_start_time}} >
                {{/ifCond}}

                    <i class = "icon-time"></i>waited {{meal_wait_time.min}}m, {{meal_wait_time.second}}s
                    </span>

                <h3 class = "user-{{dinerInfo.id}}">{{meal_table_name}}</h3>
                <span class = 'user'>
                    <a class="user-profile-link" href="/staff/user/{{dinerInfo.id}}"><img src="{{dinerInfo.diner_avatar_url}}" /></a>
                    <h4>{{ dinerInfo.diner_name}}</h4>
                </span>

                <span class = "user-summary">
                    <p class = 'profile-tab'>{{dinerInfo.diner_visits}} visits</p>
                    <p class = 'profile-tab'>{{dinerInfo.diner_average_spend}} ave</p>
                    <a href="/staff/user/{{dinerInfo.id}}" class = 'view-profile'><i class="icon-user"></i>Profile</a>
                </span>

                {{#ifCond status "===" 0 }}
                    <ul class = "order">

                        {{#ifCond  promotion_note '!==' ''}}
                            <li style="color:red">{{promotion_note}}</li>
                        {{/ifCond}}

                        {{#ifCond  note '!==' ''}}
                            <li>{{note}}</li>
                        {{/ifCond}}

                        {{#each orders}}

                            <li id="page-order-container-{{orders.id}}">
                                <em class ='quantity'>{{quantity}}x</em>
                                <p> {{dish_name}} </p>
                                <em class='pos'>{{dish_pos}}</em>
                            </li>

                            {{#ifCond note '!==' ''}}
                                <li>{{note}}</li>
                            {{/ifCond}}
                        {{/each}}

                        <li class="end">
                            ---end---
                        </li>

                    </ul>
                {{/ifCond}}

                {{#ifCond status "===" 0 }}
                <a class="acknowledge ack-button" rel="order" model="meal" id="{{id}}"><i class="icon-check-sign"></i> Acknowledge</a>
                {{/ifCond}}

                {{#ifCond status "===" 2 }}
                    {{#ifCond  promotion_note '!==' ''}}
                        <ul>
                            <li style="color:red">{{promotion_note}}</li>
                        </ul>
                    {{/ifCond}}
                <img class="icon" src="/static/img/bill.png"/>
                <a class="closebill ack-button" rel="bill" model="meal" id="{{id}}"><i class="icon-money"></i> Close Bill</a>
                {{/ifCond}}


        </script>

        <script id="card-template-request" type="text/x-handlebars-template">
                {{#ifCond request_wait_time.min '>=' 1 }}
                    <span class = "urgent time countdown" start = {{request_start_time}}>
                {{else}}
                    <span class = "early time countdown" start={{request_start_time}}>
                {{/ifCond}}

                    <i class = "icon-time"></i>waited {{request_wait_time.min}}m, {{request_wait_time.second}}s
                    </span>

                <h3 class="user-{{meal.diner.id}}">{{request_table_name }}</h3>

                <span class='user'>
                    <a class="user-profile-link" href="/staff/user/{{dinerInfo.id}}"><img src="{{dinerInfo.diner_avatar_url}}" /></a>
                    <h4>{{dinerInfo.diner_name}}</h4>
                </span>

                <span class="user-summary">
                    <p class='profile-tab'> {{dinerInfo.diner_visits}} visits</p>
                    <p class='profile-tab'>${{dinerInfo.diner_average_spend}} ave</p>
                    <a href="/staff/user/{{dinerInfo.id}}" class='view-profile'><i class="icon-user"></i> Profile</a>
                </span>

                {{#ifCond note '!==' ""}}
                <p class="note">
                    {{note}}
                </p>
                {{/ifCond}}

                {{#ifCond request_type '==' 0}}
                    <img class="icon" src="/static/img/water.png"/>
                {{/ifCond}}

                {{#ifCond request_type '==' 1}}
                    <img class="icon" src="/static/img/waiter.png"/>
                {{/ifCond}}

                <a class="respond ack-button" rel="req" model="request" id={{id}}><i class="icon-check-sign"></i> Acknowledge</a>
        </script>
        {% endverbatim %}

    </div>


    {% cache 600 "dropdown" outlet.id %}
    <div id="dropdown-for-page" class="dropdown dropdown-tip">
        <ul class="dropdown-menu">
            {% for table in table_list %}
            <li><a data-toTableId="{{table.id}}" class="targetTable">
            to table {{table.name|capfirst}}
            </a></li>
            {% endfor %}
        </ul>
    </div>

    <div id="dropdown-for-categories" class="dropdown dropdown-tip">
        <ul class="dropdown-menu">
            {% for category in categories %}
            <li><a data-categoryId="{{category.id}}" class="targetCategory" onclick="chooseCategory(this);">
            {{category.name|capfirst}}
            </a></li>
            {% endfor %}
        </ul>
    </div>

    {% for category in categories %}
    <div id="dropdown-for-dish-category-{{category.id}}" class="dropdown dropdown-tip">
        <ul class="dropdown-menu">
        {% for dish in dishes|key:category.id %}
            <li><a data-dishId="{{dish.id}}" class="targetDish" onclick="chooseDish(this);">
            {{dish.name|capfirst}}
            </a></li>
        {% endfor %}
        </ul>
    </div>
    {% endfor %}
    {% endcache %}
{% endblock content %}
