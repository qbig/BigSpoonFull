{% extends "staff.html" %}
{% load staticfiles %}
{% load compress %}
{% load cache %}
{% load menufilters %}
{% block content %}
    <div class="wrapper">
    
    <!-- {% if cards %}
        {% for card in cards %}
            {% if card.orders %}
                {% with card as meal %}
                <div class="item" id="card-{{meal.diner.id}}">
                    {% if meal.wait_time.0 >= meal.table.outlet.threshold %}
                    <span class="urgent time countdown" start={{meal.count_down_start}}>
                    {% else %}
                    <span class="early time countdown" start={{meal.count_down_start}}>
                    {% endif %}
                        <i class="icon-time"></i> waited {{meal.wait_time.0}}m, {{meal.wait_time.1}}s
                    </span>
                    
                    <h3 class="user-{{meal.diner.id}}">{{ meal.table.name }}</h3>
                    {% cache 300 "diner" meal.diner_id %}
                    <span class='user'>
                            <a class="user-profile-link" href="/staff/user/{{meal.diner.id}}"><img src="{{meal.diner.avatar_url}}" /></a>
                            <h4>{{ meal.diner.get_full_name }}</h4>
                    </span>
                    <span class="user-summary">
                    <p class='profile-tab'>{{ meal.diner.get_num_of_visits_for_recent_outlet }} visits</p>
                    <p class='profile-tab'>${{ meal.diner.get_average_spending_for_recent_outlet }} ave</p>
                    <a href="/staff/user/{{meal.diner.id}}" class='view-profile'><i class="icon-user"></i> Profile</a>
                    </span>
                    {% endcache %}
                    {% if meal.diner.profile.is_vegetarian == 'Y' and meal.diner.profile.is_muslim == 'Y' %}
                        <p class="notice"><i class="icon-warning-sign"></i> Vegetarian & Muslim</p>
                    {% elif meal.diner.profile.is_vegetarian == 'Y' %}
                        <p class="notice"><i class="icon-warning-sign"></i> Vegetarian</p>
                    {% elif meal.diner.profile.is_muslim == 'Y' %}
                        <p class="notice"><i class="icon-warning-sign"></i> Muslim</p>
                    {% endif %}

                    {% if meal.diner.profile.allergies %}
                    <p class="allergy">
                        Allergic to: {{meal.diner.profile.allergies}}
                    </p>
                    {% endif %}
                    {% if meal.status == 2 %}
                    <img class="icon bill" src="{% static "img/bill.png" %}"/>
                    {% else %}
                    <ul class="order">
                        {% if meal.note %}
                            <li>
                                {{meal.note}}
                            </li>
                        {% endif %}
                        {% if meal.orders.count > 0 %}
                            {% for order in meal.orders.select_related %}
                                {% if not order.is_finished %} 
                                <li id="page-order-container-{{order.id}}">
                                    <em class='quantity'>{{order.quantity}}x</em>
                                    <p>{{order.dish.name}}</p>
                                    {% if order.dish.pos %}
                                    <em class='pos'>{{order.dish.pos}}</em>
                                    {% endif %}
                                </li>
                                    {% if order.note %}
                                        {% autoescape on %}
                                        <li>{{ order.note | linebreaksbr }}</li>
                                        {% endautoescape %}
                                        
                                    {% endif%}
                                {% endif %}
                            {% endfor %}
                        {% else %}
                            <li class="no-order">No orders yet.</li>
                        {% endif %}
                        <li class="end">
                            --- end ---
                        </li>
                    </ul>
                    {% endif %}

                    {% if meal.status == 0 %}
                        <a class="acknowledge ack-button" rel="order" model="meal" id="{{meal.id}}"><i class="icon-check-sign"></i> Acknowledge</a>
                    {% elif meal.status == 2 %}
                    <a class="closebill ack-button" rel="bill" model="meal" id={{meal.id}}><i class="icon-money"></i> Close Bill</a>
                    {% endif %}
                </div>
                {% endwith %}
            {% else %}
                {% with card as request %}
                <div class="item request">
                    {% if request.wait_time.0 >= request.table.outlet.threshold %}
                        <span class="urgent time countdown" start={{request.count_down_start}}>
                    {% else %}
                        <span class="early time countdown" start={{request.count_down_start}}>
                    {% endif %}
                            <i class="icon-time"></i> waited {{request.wait_time.0}} m, {{request.wait_time.1}} s
                        </span>
                        <h3 class="user-{{meal.diner.id}}">{{ request.table.name }}</h3>
                        {% cache 300 "diner" request.diner_id %}
                        <span class='user'>
                            <a class="user-profile-link" href="/staff/user/{{request.diner.id}}"><img src="{{request.diner.avatar_url}}" /></a>
                            <h4>{{ request.diner.get_full_name }}</h4>
                        </span>
                        <span class="user-summary">
                            <p class='profile-tab'>{{ request.diner.get_num_of_visits_for_recent_outlet }} visits</p>
                            <p class='profile-tab'>${{ request.diner.get_average_spending_for_recent_outlet }} ave</p>
                            <a href="/staff/user/{{request.diner.id}}" class='view-profile'><i class="icon-user"></i> Profile</a>
                        </span>
                        {% endcache %}
                        {% if request.note %}
                        <p class="note">
                            {{request.note}}
                        </p>
                        {% endif %}

                        {% if request.request_type == 0 %}
                        <img class="icon" src="{% static "img/water.png" %}"/>
                        {% elif request.request_type == 1%}
                        <img class="icon" src="{% static "img/waiter.png" %}"/>
                        {% endif %}
                        <a class="respond ack-button" rel="req" model="request" id="{{request.id}}"><i class="icon-check-sign"></i> Acknowledge</a>
                </div>
                {% endwith %}
            {% endif %}
        {% endfor %}
    </div>
    <center>
        <div class="pagination">
            {% if cards.has_previous %}
            <a href="?page={{ cards.previous_page_number }}"><i class="icon-circle-arrow-left"></i></a>
            {% endif %}

            {% if cards.has_next %}
            <a href="?page={{ cards.next_page_number }}"><i class="icon-circle-arrow-right"></i></a>
            {% endif %}
        </div>
    </center>
    {% else %}
        <p class="no-cards"><i class="icon-smile"></i> You have no pending orders!</p>
    </div>
    {% endif %} -->
       {% verbatim %} 

        
        <! handlebar for order template->
        <script id="card-template-order" type="text/x-handlebars-template">
                <!--based on the time, determine whether it is urgent or not, different in appearance-->                    
                {{#ifCond meal_wait_time.min '>=' 3}}
                    <span class = "urgent time countdown" start = {{meal_start_time}}>
                {{else}}
                    <span class = "early time countdown" start= {{meal_start_time}} >
                {{/ifCond}}
                
                    <i class = "icon-time"></i>waited {{meal_wait_time.min}}m, {{meal_wait_time.second}}s
                    </span>
            
                <h3 class = "user-{{dinerInfo.id}}">{{meal_table_name}}</h3>
                <span class = 'user'>
                    <a class="user-profile-link" href="/staff/user/{{dinerInfo.id}}"><img src="{{dinerInfo.diner_avatar_rul}}" /></a>
                    <h4>{{ dinerInfo.diner_name}}</h4>
                </span>
                
                <span class = "user-summary">
                    <p class = 'profile-tab'>{{dinerInfo.diner_visits}} visits</p>
                    <p class = 'profile-tab'>{{dinerInfo.diner_average_spend}} ave</p>
                    <a href="/staff/user/{{dinerInfo.id}}" class = 'view-profile'><i class="icon-user"></i>Profile</a>
                </span>
                
                    <!--
                    <p class="notice"><i class="icon-warning-sign"></i> Vegetarian & Muslim</p>
                    
                    {{#ifCond status "===" 0 }}
                        {{#ifCond dinerInfo.diner_profile.is_vegetarian '==' 'Y'}}
                            <p class="notice"><i class="icon-warning-sign"></i> Vegetarian</p>
                        {{/ifCond}}
                        
                        {{#ifCond dinerInfo.diner_profile.is_muslim '==' 'Y'}}
                             <p class="notice"><i class="icon-warning-sign"></i> Muslim</p>
                        {{/ifCond}}
                        
                        {{#ifCond dinerInfo.diner_profile.allergies '!==' ''}}
                        <p class="notice">
                            Allergic to: {{dinerInfo.diner_profile.allergies}}
                        </p>
                        {{/ifCond}} 
                    {{/ifCond}} 
                
                    --> 
                
                {{#ifCond status "===" 0 }}
                    <ul class = "order">
                        
                        {{#ifCond  note '!==' ''}}  
                            <li>{{note}}</li>
                        {{/ifCond}}
                        
                        {{#each orders}}
                    
                            <li id="page-order-container-{{orders.id}}">
                                <em class ='quantity'>{{quantity}}x</em>
                                <p> {{dish_name}} </p>
                                <em class='pos'>{{dish_pos}}</em>
                            </li>
                            
                            {{#ifCond note '!==' ''}}
                                <li>{{note}}</li>
                            {{/ifCond}}

                            
                        {{/each}}
                        
                        <li class="end">
                            ---end---
                        </li>
                        
                    </ul>
                {{/ifCond}}
                
                {{#ifCond status "===" 0 }}
                    <a class="acknowledge ack-button" rel="order" model="meal" id="{{id}}"><i class="icon-check-sign"></i> Acknowledge</a>
                {{/ifCond}}
                
                {{#ifCond status "===" 2 }}
                    <img class="icon" src="/static/img/bill.png"/>
                    <a class="closebill ack-button" rel="bill" model="meal" id="{{id}}"><i class="icon-money"></i> Close Bill</a>
                {{/ifCond}}
                        
            
        </script>
        
        <! handlebar template for request card>
        <script id="card-template-request" type="text/x-handlebars-template">

                {{#ifCond request_wait_time.min '>=' 1 }}
                    <span class = "urgent time countdown" start = {{request_start_time}}>
                {{else}}
                    <span class = "early time countdown" start={{request_start_time}}>
                {{/ifCond}}
                
                    <i class = "icon-time"></i>waited {{request_wait_time.min}}m, {{request_wait_time.second}}s
                    </span>
                    
                <h3 class="user-{{meal.diner.id}}">{{request_table_name }}</h3>
                
                <span class='user'>
                    <a class="user-profile-link" href="/staff/user/{{dinerInfo.id}}"><img src="{{dinerInfo.diner_avatar_url}}" /></a>
                    <h4>{{dinerInfo.diner_name}}</h4>
                </span>
                
                <span class="user-summary">
                    <p class='profile-tab'> {{dinerInfo.diner_visits}} visits</p>
                    <p class='profile-tab'>${{dinerInfo.diner_average_spend}} ave</p>
                    <a href="/staff/user/{{dinerInfo.id}}" class='view-profile'><i class="icon-user"></i> Profile</a>
                </span>
                            
                {{#ifCond request.note '==' ""}}
                <p class="note">
                    {{note}}
                </p>
                {{/ifCond}}                     
                
                {{#ifCond request_type '==' 0}}
                    <img class="icon" src="/static/img/water.png"/>
                {{/ifCond}}
                
                {{#ifCond request_type '==' 1}}
                    <img class="icon" src="/static/img/waiter.png"/>
                {{/ifCond}}
                
                <a class="respond ack-button" rel="req" model="request" id={{id}}><i class="icon-check-sign"></i> Acknowledge</a>
            
        </script>
        {% endverbatim %}

    </div> 




    {% cache 600 "dropdown" outlet.id %}
    <div id="dropdown-for-page" class="dropdown dropdown-tip">
        <ul class="dropdown-menu">
            {% for table in table_list %}
            <li><a data-toTableId="{{table.id}}" class="targetTable">
            to table {{table.name|capfirst}}
            </a></li>
            {% endfor %}
        </ul>
    </div>

    <div id="dropdown-for-categories" class="dropdown dropdown-tip">
        <ul class="dropdown-menu">
            {% for category in categories %}
            <li><a data-categoryId="{{category.id}}" class="targetCategory" onclick="chooseCategory(this);">
            {{category.name|capfirst}}
            </a></li>
            {% endfor %}
        </ul>
    </div>

    {% for category in categories %}
    <div id="dropdown-for-dish-category-{{category.id}}" class="dropdown dropdown-tip">
        <ul class="dropdown-menu">     
        {% for dish in dishes|key:category.id %}
            <li><a data-dishId="{{dish.id}}" class="targetDish" onclick="chooseDish(this);">
            {{dish.name|capfirst}}
            </a></li>                    
        {% endfor %}
        </ul>
    </div>                    
    {% endfor %}
    {% endcache %}
{% endblock content %}
